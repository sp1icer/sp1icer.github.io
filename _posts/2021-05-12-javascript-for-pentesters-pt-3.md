---
title: "JavaScript for Pentesters: Part 3"
date: 2021-07-17
classes: wide
excerpt_separator: <!--more-->
categories:
  - writeups
tags:
  - oswe.prep
  - javascript
  - pentester.academy
---

## >> INTRO

This blog post *is* part of a series, so if you missed any of the posts they're listed below.

* [JavaScript for Pentesters: Intro](/_posts/2021-04-26-javascript-for-pentesters-intro.md)
* [JavaScript for Pentesters: Part 2](/_posts/2021-05-05-javascript-for-pentesters-pt-2.md)
* JavaScript for Pentesters: Part 3  ** <-- YOU ARE HERE

## >> LUCKY NUMBER SEVEN

>Challenge URL: http://pentesteracademylab.appspot.com/lab/webapp/jfp/7

Let's start the same as we have in the past few challenges - check the prompt on the page to see what our goal is:

![Challenge 7 prompt image.](/assets/images/js-for-pentesters/c7/c7-prompt.png)

Sweet - now we're getting to some pretty interesting code! I made mention of making a JS keylogger in a previous post; ask and ye shall receive, I guess. Let's start by figuring out how to capture keystrokes in an effective manner, then we'll move to sending it to our attacker-controlled server.

The key to this one is to not overthink it - you can spend a lot of time fuff'ing about, thinking about the _optimal_ way to do this. Or you can do what I did and just got to [the MDN docs for the keypress event listener](https://developer.mozilla.org/en-US/docs/Web/API/Document/keypress_event). Even though this listener is deprecated, we can still use it - we're not full-stack devs or anything - and be on our merry way. Looking in the docs, we see this line of code as an example:

```javascript
document.onkeypress = logKey;
```

Fantastic! That will work wonderfully for us - on the right side of the assignment, we have to use a reference to a function. In this case, an anonymous function will do us nicely :) Modifying it for our purposes, this is how it looks...

```javascript
document.onkeypress = function (e) { };
```

Looking around some more, it appears that we can fetch the value of the key pressed with `` `${e.code}` ``. So mix it all up and we've got the following to print it out to the console:

```javascript
document.onkeypress = function (e) { console.log( `${e.code}` ) };
```

Load that up in your console, then click back into the webpage. You should see all of your keystrokes captured in the console like `KeyA`, `KeyS`, etc. Now all that's left to do is send that over the wire to our server. As with previous posts, make sure your `ngrok` server is running, set up the XSS, and change the payload to a variation of `fetch` with the URL being your server + the keypress code to have a functioning JS keylogger! Just make sure to watch the web requests in the Python server:

![Full exploit in a gif.](/assets/images/js-for-pentesters/c7/c7-full-exploit.gif)

## >> EIGHT BALL, CORNER POCKET

>Challenge URL: http://pentesteracademylab.appspot.com/lab/webapp/jfp/8

Alright, so 7's out of the way - let's check in on the Challenge 8 prompt to see what our goal is:

```
1. Pop the password in an alert box when the user submits the form
```

So looking at this I see two parts - the first is that we need to figure out when the button is clicked; the other part being that we need to use an alert to display the contents of the password field. If you've kept up with the other parts of this series, you'll know my style of research by now - just Google the different actions needed - so let's jump directly to our old friend `getElementsByClassName` paired up with [the onClick event listener](https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onclick) to target the button.

```javascript
document.getElementsByClassName("btn")[0].onclick = function () { alert('hello') }
```

Running that produces the expected "hello" popup:

![Using JavaScript to make the website tell us "hello" on a button click.](/assets/images/js-for-pentesters/c8/c8-hello.gif)

Neat. Now on to the second part - we have to figure out how to get the contents of a particular form field. For this one I just used a bit of intuition; by using `document.getElementsById` and pairing that with the `.value` attribute, we can retrieve the value that's in the box (hint: it's not a bunch of dots)! Now we just have to combine it with the original payload...

```javascript
document.getElementsByClassName("btn")[0].onclick = function () { alert(document.getElementsByClassName("input-block-level")[1].value) }
```

...and add it to our `c8.js` file. Unfortunately for us it doesn't look like the `?url` parameter works on this page - we'll just have to do it locally ðŸ˜”

![Full exploit in a gif.](/assets/images/js-for-pentesters/c8/c8-full-exploit.gif)

## >> CHALLENGE 9

>Challenge URL: http://pentesteracademylab.appspot.com/lab/webapp/jfp/9

Two challenges down, one to go. What does the magical prompt have for us this time?

```
1. Include an external JS file into this page
2. Code inside that JS should pop the cookie inside an alert box
```

So it looks like we were a little quick on the draw - objective 1 is something we've been doing this whole time ðŸ™ƒ Oh well, it hasn't been _bad_ practice or anything. Pew pew!

![Pew pew pew pew!](/assets/images/js-for-pentesters/c9/c9-pewpew.gif)

Well since we already know how to include external files, let's get on with learning how to pop cookies into the alert box. [From the MDN docs on cookies](https://developer.mozilla.org/en-US/docs/Web/API/Document/cookie), we see that you can just snag the entire group of cookies with `document.cookie`. Since the PTA team didn't give us a specific cookie to steal, we'll just go ahead and do that! Here's what the code will look like:

```javascript
alert(document.cookie);
```

"Really," I hear you say, "that's all it takes?" Yes, yes it does. Check out the action here:

![Full exploit in a gif.](/assets/images/js-for-pentesters/c9/c9-full-exploit.gif)

## >> SKIDDY-POP-POP-POW, YA DUN NOW

Thanks for sticking around for another fun JavaScript adventure. Hopefully you're digging these and learning from them - I'm certainly having a fun time practicing my JavaScript a bit - and hopefully you see the value in the scripts we're creating. As always, make sure to ~~like and subscribe~~ heart and retweet this on Twitter, keep on keeping on and happy hacking! ðŸ¤˜

\- sp1icer

## >> REFERENCES

[https://developer.mozilla.org/en-US/docs/Web/API/Document/keypress_event](https://developer.mozilla.org/en-US/docs/Web/API/Document/keypress_event)  
[https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onclick](https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onclick)  
[https://developer.mozilla.org/en-US/docs/Web/API/Document/cookie](https://developer.mozilla.org/en-US/docs/Web/API/Document/cookie)  